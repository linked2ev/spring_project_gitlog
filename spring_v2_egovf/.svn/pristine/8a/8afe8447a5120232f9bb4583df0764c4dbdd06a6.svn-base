<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" %><jsp:include page="/WEB-INF/jsp/fo/include/headSurvey.jsp" /></head><!-- header --><jsp:include page="/WEB-INF/jsp/fo/include/header/headerPanel${panelAuth }.jsp" flush="false" /><!-- // header --><body><!-- main --><main id="main" class="main respWidth">	<div class="containerWrap">	<!-- leftNav -->  	<jsp:include page="/WEB-INF/jsp/fo/include/left/leftPanel${panelAuth }.jsp" flush="false" />	<!-- // leftNav --> 			<div class="pageWrap rndBaseSurvey2">			<div class="page-title" style="padding-top: -30px;">				<h2><spring:message code="menu.015"/></h2>				<div class="page-location">					<span class="home"><spring:message code="menu.010"/></span> - <spring:message code="menu.011"/> - <spring:message code="menu.014"/> - <b><spring:message code="menu.015"/></b>				</div>			</div>			  			<div class="page-content">								<div class="page-process">					<ul class="process-list">						<li class="stepNm stepOn"><span><spring:message code="appStep.000"/></span></li>						<li class="stepArrow"><span></span></li>						<li class="stepNm"><span><spring:message code="appStep.001"/></span></li>					</ul>				</div>								<form id="form" name="form" enctype="multipart/form-data">					<input type="hidden" name="EXAM_MNG_NO" id="EXAM_MNG_NO" value="<c:out value="${commandMap.EXAM_MNG_NO }"/>"/>					<input type="hidden" name="refererUrl" value="<c:out value="${commandMap.refererUrl }"/>"/>					<input type="hidden" name="EXAM_TYPE" id="EXAM_TYPE" value="DETAIL_TYPE"/>										<input type="hidden" name="surveyResult" id="surveyResult" value="<c:out value="${commandMap.surveyResult}"/>">										<div class="join-term mgtp20" id="termSurveyDiv">						<div class="term-wrap" style="height: 180px;">							<div class="term-text" id="agreeHtml">								<!-- 상세설문 동의서 -->								<c:out value="${agreeInfo.ENTRY_APP_AGREE_CONTENT }" escapeXml="false"/>							</div>						</div>						<div class="termAgree-chk">							<input type="checkbox" id="termAgree" name="termAgree" value="Y" <c:if test="${commandMap.termAgree eq 'Y'}">checked="checked"</c:if>>							<label for="termAgree"><spring:message code="appStep.002"/></label>						</div>					</div>								</br></br>								<div class="page-title-sub">					<h3><spring:message code="appStep.003"/></h3>				</div>								<div class="tblWrap tbl-wm surveyWrap" id="surveyElement" style="overflow-y:scroll; height: 500px;">					<!-- 상세설문 Survey 영역 -->				</div>								<div class="page-title-sub mgtp30">					<h3><spring:message code="button.file.000"/></h3>				</div>				<div class="tblWrap tbl-wm">					<div class="file-box">						<input type="text" class="fileName inputBox" readonly="readonly" style="width:340px;" value="<c:out value="${finishInfo.ORIGIN_FILE_NAME }"/>">						<label for="upload-name" class="btn btn-5th btn-blue btn_file"><spring:message code="button.file.001"/></label>						<input type="file" id="upload-name" class="upload-name" name="UPLOAD_FILE_NAME">					</div>				</div>								</form>								<div class="btn-wrap btnC">					<button type="button" class="btn btn-prim btn-white wd50" id="fn_cancel"><spring:message code="button.003"/></button>					<button type="button" class="btn btn-prim btn-white wd50" id="fn_goPrevious"><spring:message code="button.003"/></button>					<button type="button" class="btn btn-prim btn-red wd50" id="fn_goNext"><spring:message code="button.004"/></button>					<button type="button" class="btn btn-prim btn-red wd50" id="fn_goApplicationStep2"><spring:message code="button.004"/></button>				</div>			</div><!-- // page-content -->		</div><!-- // pageWrap -->	</div><!-- // container --></main><!-- // main --><!-- footer --><jsp:include page="/WEB-INF/jsp/fo/include/footer.jsp" /><!-- // footer --><script>	var uploadFile = $('.file-box .upload-name');	uploadFile.on('change', function(){		if(window.FileReader){			var filename = $(this)[0].files[0].name;		} else {			var filename = $(this).val().split('/').pop().split('\\').pop();		}		$(this).siblings('.fileName').val(filename);	});	Survey.Survey.cssType = "bootstrap";		//_____특수기호 '|' 사용 제한_____	var MyTextValidator = (function (_super) {	    Survey.__extends(MyTextValidator, _super);	    function MyTextValidator() { 	        _super.call(this);	    }	    MyTextValidator.prototype.getType = function () { return "mytextvalidator"; };	    MyTextValidator.prototype.validate = function (value, name) {	        if(value.indexOf("|") >= 0) {	            return new Survey.ValidatorResult(null, new Survey.CustomError(this.getErrorText(name)));	        }	        return null;	    };	    MyTextValidator.prototype.getDefaultErrorText = function(name) {	        return fnLang("'|'는 사용하실 수 없습니다.", "LC00");	    }	    return MyTextValidator;	})(Survey.SurveyValidator);	Survey.MyTextValidator = MyTextValidator;		Survey.JsonObject.metaData.addClass("mytextvalidator", [], function () { return new MyTextValidator(); }, "surveyvalidator");	//__________________________________		/* survey create */	var survey = new Survey.Model('{"pages":'+ jsonStrReturn(${detailSurveyTxt}) + '}');	survey.requiredText = "";	survey.showNavigationButtons = false;	survey.questionTitleTemplate = "{no}) {title}";	/* data binding */	survey.data = jsonParseReturn(jsonStrReturn(${answerTxt}));	 	var tPage = survey.pagesValue.length;  // 전체 페이지		setRequiredAll(survey, true, "surveyElement");	  	//서베이 필수체크 여부 설정   	function setRequiredAll(item, required, surveyElement){		var q = item.getAllQuestions(true);		for(var i = 0; i < q.length; i++){			if(typeof q[i].isAllRowRequired != "undefinded" && q[i].isAllRowRequired == false){				q[i].isAllRowRequired = required;			}else{				q[i].isRequired = required;			}		}		item.render(surveyElement);	}	$(function(){		surveyPaging = function(){				var cPage = survey.currentPageValue.visibleIndex + 1;		//console.log(">> cPage: " + cPage);		if(cPage == 1){			$("#termSurveyDiv").show();			$("#fn_cancel").show();			$("#fn_goPrevious").hide();		}		if(cPage == 2){			$("#termSurveyDiv").hide();			$("#fn_cancel").hide();			$("#fn_goPrevious").show();		} 		if(tPage <= cPage){			$("#fn_goNext").hide();			$("#fn_goApplicationStep2").show();		}else{			$("#fn_goNext").show();			$("#fn_goApplicationStep2").hide();		}			}	$("#fn_goPrevious").hide();  	$("#fn_goApplicationStep2").hide();			// 이전 버튼 클릭 이벤트(설문조사)	$(document).on("click", "#fn_goPrevious", function(){		$(".sv_prev_btn").trigger("click");		surveyPaging();	});		// 다음 버튼 클릭 이벤트(설문조사)	$(document).on("click", "#fn_goNext", function(){				if(!$('input:checkbox[name="termAgree"]').is(":checked")){			$("#termAgree").focus();			returnMsg.alertMsg(fnLang("상세설문 이용약관에 동의해주세요.", "LC01"));			return;		}		// 상세설문 동의서		$("#agreeHtml").hide();				$(".sv_next_btn").trigger("click");		surveyPaging();	});	 	// 취소 버튼 클릭 이벤트    $(document).on("click", "#fn_cancel", function(){				if($("#finishBtn").hasClass("btn-dis") < 1){			returnMsg.confirmMsg(fnLang("정말로 취소하겠습니까?", "LC02"), "confirm");					}									}); 		// 취소 버튼 클릭 이벤트 > confirm 	$(document).on("click", "#confirmY", function () {		var $el = $("#confirmMsg");		var isDim = $el.prev().hasClass('dimBack');				isDim ? $el.parents('.popupWrap').fadeOut() : $el.fadeOut(); // 레이어 닫기				var $form = $("#form");		$form.attr({"action":"<c:url value='/fo/ta/testAnnounceView.do'/>", "target":"_self", "method":"post"}).submit();	});		// step1. 다음 버튼 클릭 이벤트	$(document).on("click", "#fn_goApplicationStep2", function(){				if(!$('input:checkbox[name="termAgree"]').is(":checked")){			$("#termAgree").focus();			returnMsg.alertMsg(fnLang("상세설문 이용약관에 동의해주세요.", "LC03"));			return;		}		 		if(JSON.stringify(survey.data) != "{}"){			$('#surveyResult').val(JSON.stringify(survey.data)); 		} 				$(".sv_complete_btn").trigger("click");				if(survey.isCompleted == true){			// 설문조사 저장 호출			fn_surveyResultSave("COMPLETE");		}	}); 		// step2. 설문조사 저장	function fn_surveyResultSave(type){		var saveType = type;		var $form    = $("#form");		var examMngNo = $("#EXAM_MNG_NO").val();				if(examMngNo != null && examMngNo != ""){						 $.ajax({		            async : false,		            type : "POST",		            dataType: "json",		            data : $form.serialize(),		            url : "<c:url value='/fo/mj/surveyResultDelete.do'/>",		            success : function (data){		            	//console.log(">> step1. survey Delete: ", data);		                if(data.resultYn != null || data.resultYn != ""){									                	var form = $("#form")[0];		          	        var params = new FormData(form);		          	        		                	$.ajax({		        	        	async : false,		        	            type : "POST",		        	            enctype: "multipart/form-data",		        	            dataType: "json",		        	            contentType: false,		        	            processData: false,   		        	            data : params,		        	            url : "<c:url value='/fo/mj/surveyResultInsert.do'/>",		        	            success : function (data){	        	                	$("#form").attr({"action":"<c:url value='/fo/ta/testAnnounceApplicationStep2.do'/>", "target":"_self", "method":"post"}).submit();		        	            },		        	            error : function (err){		        	            	returnMsg.alertMsg(fnLang("데이터 처리 중 시스템 오류가 발생했습니다.", err.status), "reload");		        	            }		        	        });		                       		                }else{		                	returnMsg.alertMsg(fnLang("참가신청 중에 오류가 발생했습니다. 관리자에게 문의해주세요.", "LC05"), "reload");		                }		                $(".btn-closePop").click();		                return;		            },		            error : function (err){		            	returnMsg.alertMsg(fnLang("데이터 처리 중 시스템 오류가 발생했습니다.", err.status), "reload");		            }		        });			 		}else{			returnMsg.alertMsg(fnLang("데이터 호출 중에 실패했습니다. 다시 시도해주세요.", "LC06"), "reload");		}	}		surveyPaging();	});</script></body></html>