<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>

<jsp:include page="/WEB-INF/jsp/fo/include/head.jsp" />
</head>
<body>

<!-- header -->
<jsp:include page="/WEB-INF/jsp/fo/include/header/headerPanel${panelAuth }.jsp" flush="true" />
<!-- // header -->

<!-- main -->
<main id="main" class="main respWidth">
	<div class="containerWrap">
	
	<!-- leftNav -->  
	<jsp:include page="/WEB-INF/jsp/fo/include/left/leftPanel${panelAuth }.jsp" flush="true" />
	<!-- // leftNav -->

		<div class="pageWrap rndQna">

			<div class="page-title">
				<h2><c:out value="${info.EXAM_TITLE }"/> &nbsp;<spring:message code="menu.013"/></h2>
				<div class="page-location">
					<span class="home"><spring:message code="menu.010"/></span> - <spring:message code="menu.003"/> - <spring:message code="menu.004"/> - <b><c:out value="${info.EXAM_TITLE }"/> &nbsp;<spring:message code="menu.013"/></b>
				</div>
			</div>
			
			<div class="page-content">
			<form id="searchForm" name="searchForm">
				<input type="hidden" name="EXAM_MNG_NO" value="<c:out value="${commandMap.EXAM_MNG_NO }"/>"/>
				<input type="hidden" name="cPageNo" value="<c:out value="${commandMap.cPageNo }"/>"/>
			</form>
				
				<div class="listWrap qna-list">
					<table>
						<colgroup>
							<col width="15%">
							<col width="*">
							<col width="10%">
							<col width="18%">
						</colgroup>
						<tbody>
							<c:choose>
							<c:when test="${not empty list }">
								<c:forEach var="row" items="${list}" varStatus="i">
									<tr>
										<td>
											<c:out value="${row.CATEGORY }"/>
										</td>
										<td class="txtL">
											<a href="#" onclick="qna('list_<c:out value="${i.count }"/>');return false;">
												<c:out value="${row.TITLE }"/>
											</a>
											<c:if test="${row.NEW_YN eq 'Y'}">
												<span class="qna-new"><i class="screen_out"><spring:message code="qnaList.000"/></i></span>
											</c:if>
											<c:if test="${row.ANSWER_YN eq 'Y'}">
												<span class="qna-complete"><spring:message code="qnaList.001"/></span>
											</c:if>
										</td>
										<td>
											<span class="qna-writer"><c:out value="${row.REGI_NAME }"/></span>
										</td>
										<td>
											<span class="qna-date"><c:out value="${row.REGI_DATE }"/></span>
										</td>
									</tr>
									<tr id="list_<c:out value="${i.count }"/>" class="trList" style="display:none;">
										<td colspan="4">
											<div class="qna-expand-wrap">
												<div class="<c:if test="${row.CATEGORY_CD ne '00'}">qna-question</c:if>">
													<p>
														<c:out value="${row.CONTENT }" escapeXml="false"/>
													</p>
												</div>
												<c:if test="${row.ANSWER_YN eq 'Y'}">
													<div class="qna-answer">
														<p>
															<c:out value="${row.ANSWER }" escapeXml="false"/>
															<span class="qna-answer-uploader">
																<em><c:out value="${row.ANSWER_NAME }"/></em><i><c:out value="${row.ANSWER_DATE }"/></i>
															</span>
														</p>
													</div>
												</c:if>
											</div>
										</td>
									</tr>
								</c:forEach>
							</c:when>
							<c:otherwise>
								<tr>
									<div class="tbl-nodata"><div class="no-data"><span><spring:message code="qnaList.002"/></span></div></div>
								</tr>
							</c:otherwise>
						</c:choose>

						</tbody>
					</table>				
				</div>
				
				<div class="pageNavi" id="pageNavi">
        			<ui:paginationInfo paginationInfo="${paginationInfo}" jsFunction="fn_goPage" />
        		</div>
				
				<div class="btn-wrap btnR">
					<button type="button" href="#writeQna" class="btn btn-prim btn-red wd100 btn-popup" id="fn_addQna"><spring:message code="button.009"/></button>
				</div>
				
			</div><!-- // page-content -->
		</div><!-- // pageWrap -->

	</div><!-- // container -->
</main>
<!-- // main -->

<!-- footer -->
<jsp:include page="/WEB-INF/jsp/fo/include/footer.jsp" />
<!-- // footer -->

<!-- popup -->
<div class="popupWrap">
    <div class="dimBack"></div>
    
	<!-- 글쓰기 -->
    <div id="writeQna" class="popupBoxWrap rndQnaWrite" style="width:700px;">
    	<form id="form" name="form">
    		<input type="hidden" name="EXAM_MNG_NO" value="<c:out value="${commandMap.EXAM_MNG_NO }"/>"/>
    	
			<div class="popupBox">
				<div class="popup-container">
					<div class="popup-header">
						<div class="popup-title"><spring:message code="popup.write.000"/></div>
						<div class="popup-close">
							<button class="btn-closePop" onclick="fn_closePopup();"><i class="ico-close"></i><span class="screen_out"><spring:message code="button.005"/></span></button>
						</div>
					</div>
					<div class="popup-content">
						<div class="tblWrap tbl-wm">
							<table>
								<caption><spring:message code="popup.write.001"/></caption>
								<colgroup>
									<col width="20%">
									<col width="80%">
								</colgroup>
								<tbody>
									<tr>
										<th><spring:message code="popup.write.002"/></th>
										<td>
											<select id="CATEGORY_CD" name="CATEGORY_CD" class="inputBox requireFileld" title="<spring:message code="popup.write.002"/>" style="width:180px;">
			                                    <c:if test="${not empty CTEGORY_LIST }">
			                                        <c:forEach var="codeRow" items="${CTEGORY_LIST }" varStatus="i">
			                                            <option value="<c:out value="${codeRow.CODE }"/>" >
			                                                <c:out value="${codeRow.VALUE }"/>
			                                            </option> 
			                                        </c:forEach>
			                                    </c:if>
			                                </select>
										</td>
									</tr>
									<tr>
										<th><spring:message code="popup.write.003"/></th>
										<td>
											<input type="text" id="TITLE" name="TITLE" class="inputBox requireFileld" title="<spring:message code="popup.write.003"/>">
										</td>
									</tr>
									<tr>
										<th><spring:message code="popup.write.004"/></th>
										<td>
											<textarea type="text" id="CONTENT" name="CONTENT" class="inputBox requireFileld" style="height:300px;" title="<spring:message code="popup.write.004"/>"></textarea>
										</td>
									</tr>
								</tbody>
							</table>
						</div>
						<div class="btn-wrap btnC">
							<button type="button" class="btn btn-prim btn-white btn-closePop" onclick="fn_closePopup();"><spring:message code="button.005"/></button>
							<button type="button" class="btn btn-prim btn-red" id="fn_save"><spring:message code="button.001"/></button>
						</div>
					</div><!-- // popup-content --> 
				</div><!-- // popup-container -->
			</div><!-- // popupBox -->
		
		</form>
    </div>
	<!-- // 글쓰기 --> 
</div>
<!-- // popup -->

<script>
$(function(){
	
	// 글쓰기 버튼 클릭 팝업 레이아웃 이벤트
	$(document).on("click", "#fn_addQna", function(){
		var $href = $(this).attr('href');
	    layer_popup($href);
	});
	
	// 글쓰기 > 저장 버튼 클릭 이벤트
	$(document).on("click", "#fn_save", function(){
		var $form = $("#form");
		var examMngNo = $form.find("input[name=EXAM_MNG_NO]").val();
		$form.find("#CONTENT").val($form.find("#CONTENT").val().replace(/\n/g, "</br>"));
		
		// FORM  필수값 검사
		if(isEmptyForm("form")){
			
		    if(examMngNo != "" && examMngNo != null){
	          	
	        	$.ajax({
	                async : false,
	                type : "POST",
	                dataType: "json",
	                data : $form.serialize(),
	                url : "<c:url value='/fo/mp/qnaBoardAjaxAdd.do'/>",
	                success : function (data){
	                    if(data.resultYn > 0){
	                    	returnMsg.alertMsg(fnLang("정상적으로 등록했습니다.", "LC00"), "reload");
	                        
	                    }else{
	                    	returnMsg.alertMsg(fnLang("등록에 실패했습니다. 다시 시도해주세요.", "LC01"));
	                    }
	                    $(".btn-closePop").click();
	                    return;
	                },
	                error : function (err){
	                	returnMsg.alertMsg(fnLang("데이터 처리 중 시스템 오류가 발생했습니다.", err.status));
	                }
	            });
	          
	        }else{
	        	returnMsg.alertMsg(fnLang("글쓰기에 실패했습니다. 다시 시도해주세요.", "LC02"));
	      	}

		};
	});
	
});

// Q&A 드랍다운 레이아웃 이벤트
function qna(idMyDiv){
	 var objDiv = document.getElementById(idMyDiv);
	 if(objDiv.style.display==""){ 
		 objDiv.style.display = "none"; 
	 }
	 else{
		 $(".trList").css("display", "none");
		 objDiv.style.display = ""; 
	 }
}

// 페이징 조회 이벤트
function fn_goPage(cPageNo) {
	var $searchForm = $("#searchForm");
	
    $("input[name='cPageNo']").val(cPageNo);
    $searchForm.attr({"action":"<c:url value='/fo/mp/qnaBoardList.do'/>", "target":"_self", "method":"post"}).submit();
}

// 글쓰기 > 닫기 버튼 클릭 이벤트
function fn_closePopup(){
	var $form = $("#form");
	$form.find("select option").eq(0).prop("selected", true);
	$form.find("input[type='text'], textarea").val("");
}

</script>	

</body>
</html>