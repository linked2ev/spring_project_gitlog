<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="MyPage">
	
	
	<sql id="myPageWhere">
			<isNotEmpty property="searchTeamGbn" prepend="AND">
					B.TEAM_GBN = #searchTeamGbn#
			</isNotEmpty>
			<isNotEmpty property="searchExamWay" prepend="AND">
						B.EXAM_WAY_CD = #searchExamWay#
			</isNotEmpty>
			<isNotEmpty property="searchVisitArea" prepend="AND">
					<isEqual property="searchExamWay" compareValue="01">
							B.VISIT_AREA_CD = #searchVisitArea#
					</isEqual>
			</isNotEmpty>
			<isNotEmpty property="searchExamTitle" prepend="AND">
					B.EXAM_TITLE LIKE '%' || #searchExamTitle# || '%'
		    </isNotEmpty>
    </sql>
    
    
	<!-- 시험신청이력 조회 목록 갯수 -->
    <select id="selectTestApplicationHistoryListCnt" parameterClass="HashMap" resultClass="Integer">
        /* MyPage.selectTestApplicationHistoryListCnt */
		SELECT
	    		COUNT(B.EXAM_MNG_NO)
		FROM 
		  		RDEI102DT A
		 		INNER JOIN RDEI101MT B
		    	ON A.EXAM_MNG_NO = B.EXAM_MNG_NO
		WHERE 
		  		A.USER_ID = #USER_ID# /* 패널ID */
		   		AND A.MSG_TRAN_YN = 'Y' /* 공고전송 */
		   		AND A.EXAM_APP_YN = 'Y' /* 시험신청 */
		   		AND TO_CHAR(TO_DATE(B.EXAM_PERIOD_TO, 'YYYYMMDD') + 60, 'YYYYMMDD') > TO_CHAR(SYSDATE, 'YYYYMMDD') /* 시험일자 종료시까지 */
		   		<include refid="myPageWhere"/>
    </select>
    
    
	<!-- 시험신청이력 조회 목록 -->
    <select id="selectTestApplicationHistoryList" parameterClass="HashMap" resultClass="HashMap">
        /* MyPage.selectTestApplicationHistoryList */
		SELECT
	    		B.EXAM_MNG_NO /* 시험관리번호 */
		        ,B.TEAM_GBN /* 시험구분 */
		        ,B.EXAM_TITLE /* 시험제목 */
		        ,TO_CHAR(TO_DATE(B.APP_PERIOD_FROM || B.APP_START_TIME || '00', 'YYYYMMDD HH24MISS'), 'YYYY-MM-DD HH24:MI') || ' ~ ' || TO_CHAR(TO_DATE(B.APP_PERIOD_TO || B.APP_END_TIME || '00', 'YYYYMMDD HH24MISS'), 'YYYY-MM-DD HH24:MI') AS APP_PERIOD /* 신청기간 */
                ,TO_CHAR(TO_DATE(B.EXAM_PERIOD_FROM, 'YYYYMMDD'), 'YYYY-MM-DD') || ' ~ ' || TO_CHAR(TO_DATE(B.EXAM_PERIOD_TO, 'YYYYMMDD'), 'YYYY-MM-DD') AS EXAM_PERIOD /* 시험기간 */
		        ,B.EXAM_WAY_CD
		        ,CASE 
		        		B.EXAM_WAY_CD WHEN '01' THEN
		        		CASE B.VISIT_AREA_CD WHEN '01' THEN '방문(서울)'
		            	ELSE '방문(용인)' END
		        ELSE '온라인'
		        END AS EXAM_WAY /* 시험방식 */
      		    ,CASE 
			    		WHEN B.RECRUIT_WAY_CD = '01' THEN '선착순'
			            ELSE '신청기간종료시까지'
			    END AS RECRUIT_WAY
		        ,CASE 
		        		WHEN A.PANEL_SEL_YN = 'Y' THEN 'selection' /* 선정 */
		        		WHEN B.EXAM_PERIOD_FROM <![CDATA[<=]]> TO_CHAR(SYSDATE, 'YYYYMMDD') THEN 'noSelection' /* 미선정 */
		            	ELSE 'applying' /* 신청중 */
		        END AS STATUS /* 상태 */
		        ,CASE WHEN A.PANEL_SEL_YN IS NULL THEN 'Y'
		            	ELSE 'N'
		        END AS CANCEL_YN /* 비고(취소가능여부) */
		FROM 
		  		RDEI102DT A
		 		INNER JOIN RDEI101MT B ON A.EXAM_MNG_NO = B.EXAM_MNG_NO
		WHERE 
		  		A.USER_ID = #USER_ID# /* 패널ID */
		   		AND A.MSG_TRAN_YN = 'Y' /* 공고전송 */
		   		AND A.EXAM_APP_YN = 'Y' /* 시험신청 */
		   		AND TO_CHAR(TO_DATE(B.EXAM_PERIOD_TO, 'YYYYMMDD') + 60, 'YYYYMMDD') > TO_CHAR(SYSDATE, 'YYYYMMDD') /* 시험일자 종료시까지 */
		   		<include refid="myPageWhere"/>
		ORDER BY 
	    		B.EXAM_PERIOD_TO ASC
    </select>
    
    
   	<!-- 시험신청현황 목록 갯수 -->
    <select id="selectTestApplicationStatusListCnt" parameterClass="HashMap" resultClass="Integer">
        /* MyPage.selectTestApplicationStatusListCnt */
		SELECT
				COUNT(B.EXAM_MNG_NO)
	    FROM 
	            RDEI102DT A
	            INNER JOIN RDEI101MT B ON A.EXAM_MNG_NO = B.EXAM_MNG_NO
	            LEFT OUTER JOIN RDEI105DT C ON A.EXAM_MNG_NO = C.EXAM_MNG_NO AND TO_CHAR(C.PREPARE_DATE, 'YYYYMMDD') = TO_CHAR(SYSDATE, 'YYYYMMDD') AND C.FINISH_YN = 'Y' AND C.SURVEY_GBN = '04' AND C.USER_ID = #USER_ID# 
	            LEFT OUTER JOIN RDEI301DT D ON A.EXAM_MNG_NO = D.EXAM_MNG_NO AND A.USER_ID = D.USER_ID AND D.EXAM_ORDER = '1'
	            LEFT OUTER JOIN RDEI103DT E ON D.EXAM_MNG_NO = E.EXAM_MNG_NO AND D.EXAM_ORDER = E.EXAM_ORDER AND D.VISIT_MNG_NO = E.VISIT_MNG_NO
	            LEFT OUTER JOIN RDEI106DT F ON D.EXAM_MNG_NO = F.EXAM_MNG_NO AND D.USER_ID = F.USER_ID
	    WHERE 
	            A.USER_ID = #USER_ID#    /* 패널ID */
	            AND A.PANEL_SEL_YN = 'Y' /* 패널선정 */
	            AND TO_CHAR(ADD_MONTHS(TO_DATE(B.EXAM_PERIOD_TO, 'YYYYMMDD'), 2), 'YYYYMMDD') > TO_CHAR(SYSDATE, 'YYYYMMDD') /* 시험일자 종료 + 2개월 까지 */
		        <include refid="myPageWhere"/>
    </select>
    
    
	<!-- 시험신청현황 조회 목록 -->
    <select id="selectTestApplicationStatusList" parameterClass="HashMap" resultClass="HashMap">
        /* MyPage.selectTestApplicationStatusList */
	    SELECT
	              B.EXAM_MNG_NO /* 시험관리번호 */
	              ,B.TEAM_GBN /* 시험구분 */
	              ,B.EXAM_TITLE /* 시험제목 */
	              ,TO_CHAR(TO_DATE(B.APP_PERIOD_FROM || B.APP_START_TIME || '00', 'YYYYMMDD HH24MISS'), 'YYYY-MM-DD HH24:MI') || ' ~ ' || TO_CHAR(TO_DATE(B.APP_PERIOD_TO || B.APP_END_TIME || '00', 'YYYYMMDD HH24MISS'), 'YYYY-MM-DD HH24:MI') AS APP_PERIOD /* 신청기간 */
	              ,TO_CHAR(TO_DATE(B.EXAM_PERIOD_FROM, 'YYYYMMDD'), 'YYYY-MM-DD') || ' ~ ' || TO_CHAR(TO_DATE(B.EXAM_PERIOD_TO, 'YYYYMMDD'), 'YYYY-MM-DD') AS EXAM_PERIOD /* 시험기간 */
	              ,B.EXAM_WAY_CD
	              ,CASE B.EXAM_WAY_CD WHEN '01' THEN
	                     CASE B.VISIT_AREA_CD WHEN '01' THEN '방문(서울)'
	                     ELSE '방문(용인)' END
	              ELSE '온라인'
	              END AS EXAM_WAY /* 시험방식 */
	              ,CASE 
	                    WHEN B.EXAM_PERIOD_FROM <![CDATA[<=]]> TO_CHAR(SYSDATE, 'YYYYMMDD') THEN 'applying'
	                    ELSE 'selection'
	              END AS STATUS /* 상태 */
	              ,CASE WHEN D.VISIT_MNG_NO IS NULL AND B.EXAM_PERIOD_FROM > TO_CHAR(SYSDATE, 'YYYYMMDD') THEN 'Y'
	                    ELSE 'N'
	              END AS VISIT_SCH_YN /* 방문예약 등록 가능 여부 */
	              ,CASE WHEN E.VISIT_MNG_NO IS NOT NULL AND F.AGREEMENT_SIGN IS NULL AND E.VISIT_DATE <![CDATA[<=]]> TO_CHAR(SYSDATE, 'YYYYMMDD') THEN 'Y'
	                   ELSE 'N'
	              END AS AGREE_YN /* 동의서 서명 필요 여부 */
	              ,CASE (SELECT COUNT(X.EXAM_MNG_NO) FROM RDEI106DT X WHERE X.EXAM_MNG_NO = A.EXAM_MNG_NO AND X.USER_ID = A.USER_ID) WHEN 0 THEN 'Y'
	                     ELSE 'N'
	              END AS AGREE_YN1 /* 동의서 서명 필요 여부 */
	              ,(
	              SELECT
	                      CASE NVL(SUM(X1.EXAM_MNG_NO), 0) 
	                              WHEN 0 THEN 'N'
	                              ELSE 'Y'
	                      END
                  FROM 
                  		  (
                  		  SELECT
                                  X.EXAM_MNG_NO
                          FROM 
                           		  RDEI103DT X
                                  INNER JOIN RDEI301DT Y ON X.EXAM_MNG_NO = Y.EXAM_MNG_NO AND X.VISIT_MNG_NO = Y.VISIT_MNG_NO
                          WHERE 
                                  X.SURVEY_PREPARE_YN = 'Y'
                                  AND X.VISIT_DATE = TO_CHAR(SYSDATE, 'YYYYMMDD')
                          GROUP BY 
                                  X.EXAM_MNG_NO
                          UNION ALL
                          SELECT
                                  X.EXAM_MNG_NO
                          FROM 
                                  RDEI104DT X
                          WHERE 
                                  ((X.SURVEY_GBN = '01' AND TO_CHAR(SYSDATE, 'YYYYMMDD') BETWEEN X.SURVEY_PERIOD_FROM AND X.SURVEY_PERIOD_TO)
                                  OR (X.SURVEY_GBN = '02' AND TO_CHAR(SYSDATE, 'YYYYMMDD') = X.SURVEY_PREPARE_DATE))
                          GROUP BY 
                                  X.EXAM_MNG_NO
                          ) X1
	               WHERE 
	                      X1.EXAM_MNG_NO = B.EXAM_MNG_NO
	               ) AS SUR_PRE_YN /* 해당 시험 설문작성 유무 여부 */
	               ,CASE NVL(C.EXAM_MNG_NO, 0) WHEN 0 THEN 'N' ELSE 'Y' END AS FINISH_YN /* 설문작성 완료 여부 */
	               ,NVL2(D.USER_ID, 'Y', 'N') AS VISIT_YN /* 방문예약 여부 */
	               ,CASE 
	                       WHEN B.RECRUIT_WAY_CD = '01' THEN '선착순'
	                       ELSE '신청기간종료시까지'
	               END AS RECRUIT_WAY
	      FROM 
	               RDEI102DT A
	               INNER JOIN RDEI101MT B ON A.EXAM_MNG_NO = B.EXAM_MNG_NO
	               LEFT OUTER JOIN RDEI105DT C ON A.EXAM_MNG_NO = C.EXAM_MNG_NO AND TO_CHAR(C.PREPARE_DATE, 'YYYYMMDD') = TO_CHAR(SYSDATE, 'YYYYMMDD') AND C.FINISH_YN = 'Y' AND C.SURVEY_GBN = '04' AND C.USER_ID = #USER_ID# 
	               LEFT OUTER JOIN RDEI301DT D ON A.EXAM_MNG_NO = D.EXAM_MNG_NO AND A.USER_ID = D.USER_ID AND D.EXAM_ORDER = '1'
	               LEFT OUTER JOIN RDEI103DT E ON D.EXAM_MNG_NO = E.EXAM_MNG_NO AND D.EXAM_ORDER = E.EXAM_ORDER AND D.VISIT_MNG_NO = E.VISIT_MNG_NO
	               LEFT OUTER JOIN RDEI106DT F ON D.EXAM_MNG_NO = F.EXAM_MNG_NO AND D.USER_ID = F.USER_ID
	       WHERE 
	             A.USER_ID = #USER_ID#    /* 패널ID */
	             AND A.PANEL_SEL_YN = 'Y' /* 패널선정 */
	             AND TO_CHAR(ADD_MONTHS(TO_DATE(B.EXAM_PERIOD_TO, 'YYYYMMDD'), 2), 'YYYYMMDD') > TO_CHAR(SYSDATE, 'YYYYMMDD') /* 시험일자 종료 + 2개월 까지 */
	          	 <include refid="myPageWhere"/>
	       ORDER BY 
	             B.EXAM_PERIOD_TO ASC
    </select>
    
    
   	<!-- 시험신청현황 조회 목록 > 방문일 목록(최초 방문일만 지정) -->
    <select id="selectVisitTimeList" parameterClass="HashMap" resultClass="HashMap">
        /* MyPage.selectVisitTimeList */
		SELECT
				A.VISIT_MNG_NO /* 방문일관리번호 */
		        ,A.VISIT_SEQ /* 표시순서 */
		        ,TO_CHAR(TO_DATE(A.VISIT_DATE || A.VISIT_TIME_FROM || '00', 'YYYYMMDD HH24MISS'), 'YYYY-MM-DD HH24:MI') || ' ~ ' || TO_CHAR(TO_DATE(A.VISIT_DATE || A.VISIT_TIME_TO || '00', 'YYYYMMDD HH24MISS'), 'HH24:MI') AS VISIT_DATE /* 방문일 목록 */
		FROM 
				RDEI103DT A
		WHERE 
				A.EXAM_ORDER = '1' /* 1차수 방문가능일만 */
		   		AND A.EXAM_MNG_NO = #EXAM_MNG_NO# /* 시험관리번호 */
		   		AND A.APP_NUM > (
		   						SELECT
		                        		COUNT(X.USER_ID) AS CNT
		                        FROM 
		                        		RDEI301DT X
		                        WHERE 
		                        		X.EXAM_MNG_NO = A.EXAM_MNG_NO
		                       			AND X.EXAM_ORDER = A.EXAM_ORDER
		                       			AND X.VISIT_MNG_NO = A.VISIT_MNG_NO
		                       			AND X.USER_ID <![CDATA[<>]]> #USER_ID#
                       			) /* 로그인한 유저ID */
		 		ORDER BY A.VISIT_SEQ
    </select>
    
    
   	<!-- 방문일 기존 등록 유무 확인 -->
    <select id="checkVisitTime" parameterClass="HashMap" resultClass="Integer">
        /* MyPage.checkVisitTime */
		SELECT
	    		COUNT(*)
		FROM 
		  		RDEI301DT A
		WHERE 
            	USER_ID = #USER_ID#
            	AND EXAM_MNG_NO = #EXAM_MNG_NO#
    </select>
    
    
    <!-- 시험신청현황 조회 목록 > 방문일 등록 -->
    <insert id="insertVisitTime" parameterClass="HashMap">
        /* MyPage.insertVisitTime */
        INSERT INTO
            RDEI301DT
            (
                EXAM_MNG_NO
                ,EXAM_ORDER
                ,USER_ID
                ,VISIT_MNG_NO
            )
        VALUES
            (
                #EXAM_MNG_NO#
                ,'1'
                ,#USER_ID#
                ,#VISIT_MNG_NO#
            )
    </insert>
    
    
    <!-- 시험신청현황 조회 목록 > 방문일 수정 -->
    <update id="updateVisitTime" parameterClass="HashMap">
        /* MyPage.updateVisitTime */
        UPDATE
            	RDEI301DT 
        SET
            	VISIT_MNG_NO = #VISIT_MNG_NO#
        WHERE
            	USER_ID = #USER_ID#
            	AND EXAM_MNG_NO = #EXAM_MNG_NO#
    </update>
    
    
    <!-- 설문작성 상세정보 > 방문일 때 : 상세정보 -->
    <select id="selectVisitResultSurveyInfo" parameterClass="HashMap" resultClass="HashMap">
        /* MyPage.selectVisitResultSurveyInfo */
        SELECT
				A.EXAM_TITLE
		        ,B.EXAM_ORDER
		        ,D.NAME
		        ,TO_CHAR(SYSDATE, 'YYYY-MM-DD') AS WRITE_DATE
	    FROM 
	    		RDEI101MT A
	    		INNER JOIN RDEI103DT B ON A.EXAM_MNG_NO = B.EXAM_MNG_NO
		 		INNER JOIN RDEI301DT C ON B.EXAM_MNG_NO = C.EXAM_MNG_NO AND B.VISIT_MNG_NO = C.VISIT_MNG_NO
			 	INNER JOIN RDUR102DT D ON C.USER_ID = D.USER_ID
		 WHERE 
		 		A.EXAM_MNG_NO = #EXAM_MNG_NO#
		   		AND C.USER_ID = #USER_ID#
		   		AND B.VISIT_DATE = TO_CHAR(SYSDATE, 'YYYYMMDD')
    </select>
    
    
    <!-- 설문작성 상세정보 > 온라인일 때-->
    <select id="selectOnlineResultSurveyInfo" parameterClass="HashMap" resultClass="HashMap">
        /* MyPage.selectOnlineResultSurveyInfo */
      SELECT
              A.EXAM_TITLE
              ,CASE B.SURVEY_GBN WHEN '01' THEN TRUNC(SYSDATE - TO_DATE(B.SURVEY_PERIOD_FROM, 'YYYYMMDD')) + 1
                                 WHEN '02' THEN TO_NUMBER(B.SEQ)
              END AS EXAM_ORDER
              ,C.NAME
              ,TO_CHAR(SYSDATE, 'YYYY-MM-DD') AS WRITE_DATE
      FROM 
              RDEI101MT A
              INNER JOIN RDEI104DT B ON A.EXAM_MNG_NO = B.EXAM_MNG_NO
              INNER JOIN RDUR102DT C ON C.USER_ID = #USER_ID#
      WHERE 
              A.EXAM_MNG_NO = #EXAM_MNG_NO#
    </select>
    
    
    <!-- 결과설문 작성 첨부파일 -->
    <select id="selectResultSurveyFinishInfo" parameterClass="HashMap" resultClass="HashMap">
        /* MyPage.selectResultSurveyFinishInfo */
      SELECT
              A.SAVE_URL
              ,A.ORIGIN_FILE_NAME
      FROM 
              RDEI105DT A
              INNER JOIN RDUR102DT B ON A.USER_ID = B.USER_ID AND A.USER_ID = #USER_ID#
      WHERE 
              A.EXAM_MNG_NO = #EXAM_MNG_NO#
              AND A.SURVEY_GBN = #SURVEY_GBN#
              AND A.EXAM_ORDER = #EXAM_ORDER#
    </select>
    
    
    <!-- 참가동의서 내용(html) 및 선정기준동의서 포함 여부 조회  -->
    <resultMap id="getAgreeSignInfo" class="HashMap">
			<result property="AGREE_CONTENT" column="AGREE_CONTENT" jdbcType="CLOB" javaType="java.lang.String" />
			<result property="AGREE_INCLUSION_YN" column="AGREE_INCLUSION_YN" />
			<result property="RESEARCHER_NAME" column="RESEARCHER_NAME" />
	</resultMap>
    <select id="selectAgreeSignInfo" parameterClass="HashMap" resultMap="getAgreeSignInfo">
        /* MyPage.selectAgreeSignInfo */
		SELECT
        		A.AGREE_CONTENT
      			,A.AGREE_INCLUSION_YN
      			,A.RESEARCHER_NAME
  		FROM 
  				RDEI101MT A
 		WHERE 
 				A.EXAM_MNG_NO = #EXAM_MNG_NO#
    </select>
    
    
    <!-- 패널 > 사인 조회 -->
    <select id="selectAgreeSignCnt" parameterClass="HashMap" resultClass="int">
    	/* MyPage.selectAgreeSignCnt */
		SELECT
				COUNT(*)
		FROM 
				RDEI106DT
	    WHERE 
	    		USER_ID = #USER_ID#
	    		AND EXAM_MNG_NO = #EXAM_MNG_NO#
    </select>
    
    
    <!-- 패널 > 선정기준동의서 사인 정보 -->
    <select id="selectAgreeSignViewInfo" parameterClass="HashMap" resultClass="HashMap">
    	/* MyPage.selectAgreeSignViewInfo */
        SELECT
        		EXAM_MNG_NO
                ,USER_ID
                ,AGREEMENT_SIGN
                ,AGREEMENT_RESEARCHER_SIGN
                ,CHOICE_RESEARCHER_SIGN
       	FROM 
       			RDEI106DT 
		WHERE
				USER_ID = #USER_ID#
				AND EXAM_MNG_NO = #EXAM_MNG_NO#
    </select>
    
    
    <!-- 패널 > 선정기준동의서 사인 등록 -->
    <insert id="insertAgreeSignSave" parameterClass="HashMap">
        /* MyPage.insertAgreeSignSave */
        INSERT INTO
            RDEI106DT
            (
                EXAM_MNG_NO
                ,USER_ID
                ,AGREEMENT_SIGN
                ,AGREEMENT_SIGN_DATE
            )
        VALUES
            (
                #EXAM_MNG_NO#
                ,#USER_ID#
                ,#AGREEMENT_SIGN#
                ,TO_CHAR(SYSDATE, 'YYYYMMDD')
            )
    </insert>
    
    
    <!-- 패널 > 선정기준동의서 사인 수정 -->
    <update id="updateAgreeSignSave" parameterClass="HashMap">
        /* MyPage.updateAgreeSignSave */
        UPDATE
            	RDEI106DT 
        SET
       			<isEqual property="AGREE_SIGN_ID" compareValue="AGREEMENT_SIGN">
					AGREEMENT_SIGN = #AGREEMENT_SIGN#
					,AGREEMENT_SIGN_DATE = TO_CHAR(SYSDATE, 'YYYYMMDD')
				</isEqual>
        WHERE
            	USER_ID = #USER_ID#
            	AND EXAM_MNG_NO = #EXAM_MNG_NO#
    </update>
    
    
    <!-- 고객 정보 수정 -->
    <update id="updateMyInfo" parameterClass="HashMap">
        /* MyPage.updateMyInfo */
        UPDATE
            	RDUR102DT 
        SET
           		PHONE = #PHONE#
            	,GENDER_CD = #GENDER_CD#
            	,BIRTH = #BIRTH#
            	,OCCU_AREA_CD = #OCCU_AREA_CD#
            	,VISIT_PREFER_CD = #VISIT_PREFER_CD#
            	,BREAK_YN = #BREAK_YN#
            	,BREAK_FROM = #BREAK_FROM#
            	,BREAK_TO = #BREAK_TO#
        WHERE
            	USER_ID = #USER_ID#
    </update>


   	<!-- 회원 탈퇴 > 현재 시험진행 존재 유무 확인 -->
    <select id="selectMyExamProceedingCnt" parameterClass="HashMap" resultClass="Integer">
        	/* MyPage.selectMyExamProceedingCnt */
			SELECT
       				COUNT(A.USER_ID) AS CNT
  			FROM 
  					RDEI102DT A
 					INNER JOIN RDEI101MT B ON A.EXAM_MNG_NO = B.EXAM_MNG_NO
 			WHERE 
 					A.USER_ID = #USER_ID#
 					AND A.EXAM_APP_YN = 'Y'
   					AND TO_CHAR(TO_DATE(B.EXAM_PERIOD_TO, 'YYYYMMDD') + 60, 'YYYYMMDD') >= TO_CHAR(SYSDATE, 'YYYYMMDD')
    </select>
    
    
    <!-- 회원 탈퇴 정보 조회 -->
    <select id="selectMemberLeaveCnt" parameterClass="com.rdpanel.cmmn.security.Panel" resultClass="Integer">
    	/* MyPage.selectMemberLeaveCnt */
        SELECT
        		COUNT(*)
       	FROM 
       			RDUR201DT 
		WHERE
				USER_ID = #USER_ID#
    </select>
	
	<!-- 시험 모집 상세 정보 : 설문 질문 목록 -->
    <resultMap id="getQuestionListMap" class="HashMap">					
		<result property="SURVEY_SEQ" 			column="SURVEY_SEQ" />
		<result property="PANEL_ROW_RANK_SEQ" 	column="PANEL_ROW_RANK_SEQ" />		
		<result property="MATRIX_ROW_RANK_SEQ" 	column="MATRIX_ROW_RANK_SEQ" />
		<result property="PAGE_NUM" 			column="PAGE_NUM" />
		<result property="QUESTION_TYPE" 		column="QUESTION_TYPE" />
		<result property="QUESTION_CONTENT" 	column="QUESTION_CONTENT" />		
		<result property="IMG_TOP" 				column="IMG_TOP" 		jdbcType="CLOB" 	javaType="java.lang.String" />
		<result property="IMG_BOTTOM" 			column="IMG_BOTTOM" 	jdbcType="CLOB" 	javaType="java.lang.String" />		
		<result property="EXAMPLE_CNT" 			column="EXAMPLE_CNT" />
		<result property="CHOICE_CNT" 			column="CHOICE_CNT" />
		<result property="COMMENT_NUMERIC_YN" 	column="COMMENT_NUMERIC_YN" />			
		<result property="TEAM_GBN" 			column="TEAM_GBN" />
	</resultMap>
	<select id="getQuestionList" parameterClass="HashMap" resultMap="getQuestionListMap">
		/* MyPage.getQuestionList */
		SELECT
		       A.SURVEY_SEQ
		      ,A.PANEL_ROW_RANK_SEQ
		      ,A.MATRIX_ROW_RANK_SEQ
		      ,A.PAGE_NUM
		      ,A.QUESTION_TYPE
		      ,A.QUESTION_CONTENT
		      ,A.IMG_TOP
		      ,A.IMG_BOTTOM
		      ,A.EXAMPLE_CNT
		      ,A.CHOICE_CNT
		      ,DECODE(A.COMMENT_NUMERIC_YN, 'Y', 'TRUE', 'FALSE') as COMMENT_NUMERIC_YN
		      ,A.TEAM_GBN
		 FROM 
		 	  RDSI101DT A
		 WHERE    
		 	  A.EXAM_MNG_NO = #PAST_EXAM_MNG_NO#	/* 설문번호 */
		      AND A.SURVEY_GBN  = #SURVEY_GBN#  	/* 설문종류 - 01:기초설문, 02: 팀별설문, 03:상세설문, 04:결과설문, 05:선정설문 */
		      AND A.EXAM_ORDER  = #EXAM_ORDER#	    /* 차수 */
		 ORDER 
		      BY SURVEY_SEQ
    </select>
    
    
    <!-- 시험 모집 상세 정보 : 설문 보기 목록 조회 -->
    <resultMap id="getAnswerListMap" class="HashMap">					
		<result property="SURVEY_SEQ" 			column="SURVEY_SEQ" />
		<result property="PANEL_ROW_RANK_SEQ" 	column="PANEL_ROW_RANK_SEQ" />		
		<result property="MATRIX_ROW_RANK_SEQ" 	column="MATRIX_ROW_RANK_SEQ" />
		<result property="EXAMPLE_SEQ" 			column="EXAMPLE_SEQ" />
		<result property="EXAMPLE_CONTENT" 		column="EXAMPLE_CONTENT" />
		<result property="IMG_LEFT" 			column="IMG_LEFT" 		jdbcType="CLOB" 	javaType="java.lang.String" />		
		<result property="IMG_RIGHT" 			column="IMG_RIGHT" 		jdbcType="CLOB" 	javaType="java.lang.String" />
		<result property="EXAMPLE_GBN" 			column="EXAMPLE_GBN" />		
	</resultMap>	
	<select id="getAnswerList" parameterClass="HashMap" resultMap="getAnswerListMap">
		/* MyPage.getAnswerList */
		SELECT
		       A.SURVEY_SEQ
		      ,A.PANEL_ROW_RANK_SEQ
		      ,A.MATRIX_ROW_RANK_SEQ
		      ,A.EXAMPLE_SEQ
		      ,A.EXAMPLE_CONTENT
		      ,A.IMG_LEFT
		      ,A.IMG_RIGHT
		      ,A.EXAMPLE_GBN
		 FROM 
		 	  RDSI102DT A
		 WHERE 
		      A.EXAM_MNG_NO = #PAST_EXAM_MNG_NO#	/* 설문번호 */
		      AND A.SURVEY_GBN  = #SURVEY_GBN#  	/* 설문종류 - 01:기초설문, 02: 팀별설문, 03:상세설문, 04:결과설문, 05:선정설문 */
		      AND A.EXAM_ORDER  = #EXAM_ORDER#		/* 차수 */
    </select>    
    
    
    <!-- 설문 정답 선택한 목록 조회 -->
	<select id="getAnswerChooseList" parameterClass="HashMap" resultClass="HashMap">
		/* MyPage.getAnswerChooseList */
		SELECT
				A.SURVEY_SEQ
		        ,A.PANEL_ROW_RANK_SEQ
		        ,A.MATRIX_ROW_RANK_SEQ
		        ,A.ANSWER
		FROM 
				RDSR101DT A
		WHERE 
				A.EXAM_MNG_NO = #EXAM_MNG_NO#
		   		AND A.SURVEY_GBN = #SURVEY_GBN#
		   		AND A.EXAM_ORDER = #EXAM_ORDER#
		   		AND A.USER_ID = #USER_ID#
    </select> 
    
       
    <!-- 설문 정답 선택한 목록 조회(결과설문/선정설문) -->
	<select id="getAnswerChooseList2" parameterClass="HashMap" resultClass="HashMap">
		/* MyPage.getAnswerChooseList2 */
		SELECT
				A.SURVEY_SEQ
		        ,A.PANEL_ROW_RANK_SEQ
		        ,A.MATRIX_ROW_RANK_SEQ
		        ,A.ANSWER
		FROM 
				RDSR201DT A
		WHERE 
				A.EXAM_MNG_NO = #EXAM_MNG_NO#
		   		AND A.SURVEY_GBN = #SURVEY_GBN#
		   		AND A.EXAM_ORDER = #EXAM_ORDER#
		   		AND A.USER_ID = #USER_ID#
    </select>
    
    
    <!-- 회원탈퇴 복구 -->
    <delete id="deleteMemberRecovery" parameterClass="HashMap">
        /* MyPage.deleteMemberRecovery */
        DELETE FROM RDUR201DT 
        WHERE USER_ID = #LEAVE_USER_ID#
    </delete>
    
    
    <!-- 패널타입 지정이력 삭제 -->
    <delete id="deleteRDPT101HT" parameterClass="HashMap">
        /* MyPage.deleteRDPT101HT */
        DELETE FROM RDPT101HT 
         WHERE USER_ID = #USER_ID#
    </delete>

    <!-- 패널타입 관리 삭제 -->
    <delete id="deleteRDPT101DT" parameterClass="HashMap">
        /* MyPage.deleteRDPT101DT */
        DELETE FROM RDPT101DT 
         WHERE USER_ID = #USER_ID#
    </delete>

    <!-- 기초/팀 설문 답변 삭제 -->
    <delete id="deleteRDSR101DT" parameterClass="HashMap">
        /* MyPage.deleteRDSR101DT */
        DELETE FROM RDSR101DT 
         WHERE USER_ID = #USER_ID#
    </delete>

    <!-- 기초/팀 설문 답변 History 삭제 -->
    <delete id="deleteRDSR101HT" parameterClass="HashMap">
        /* MyPage.deleteRDSR101HT */
        DELETE FROM RDSR101HT 
         WHERE USER_ID = #USER_ID#
    </delete>

    <!-- 회원상세정보 삭제 -->
    <delete id="deleteRDUR102DT" parameterClass="HashMap">
        /* MyPage.deleteRDUR102DT */
        DELETE FROM RDUR102DT 
         WHERE USER_ID = #USER_ID#
    </delete>

    <!-- 회원정보 마스터 삭제 -->
    <delete id="deleteRDUR101MT" parameterClass="HashMap">
        /* MyPage.deleteRDUR101MT */
        DELETE FROM RDUR101MT 
         WHERE USER_ID = #USER_ID#
    </delete>

	<!-- 탈퇴하는 회원아이디를 대체할 아이디 조회 -->
    <select id="selectNewUserId" resultClass="String">
        /* MyPage.selectNewUserId */
		SELECT
		       'CRC' || LPAD(NVL(SUBSTR(MAX(USER_ID), 4), 0) + 1, 6, 0) AS USER_ID
		  FROM RDUR201DT
		 WHERE USER_ID LIKE 'CRC%'
    </select>

	<!-- 패널현황 USER_ID 수정 -->
	<update id="updateRDEI102DT" parameterClass="HashMap">
        /* MyPage.updateRDEI102DT */
        UPDATE RDEI102DT
		   SET USER_ID = #NEW_USER_ID#
		 WHERE USER_ID = #USER_ID#
    </update>

	<!-- 설문작성결과 현황 USER_ID 수정 -->
	<update id="updateRDEI105DT" parameterClass="HashMap">
        /* MyPage.updateRDEI105DT */
        UPDATE RDEI105DT
		   SET USER_ID = #NEW_USER_ID#
		 WHERE USER_ID = #USER_ID#
    </update>

	<!-- 동의서 서명 관리 USER_ID 수정 -->
	<update id="updateRDEI106DT" parameterClass="HashMap">
        /* MyPage.updateRDEI106DT */
        UPDATE RDEI106DT
		   SET USER_ID = #NEW_USER_ID#
		 WHERE USER_ID = #USER_ID#
    </update>

	<!-- 패널별 시험비 관리 USER_ID 수정 -->
	<update id="updateRDEI201DT" parameterClass="HashMap">
        /* MyPage.updateRDEI201DT */
        UPDATE RDEI201DT
		   SET USER_ID = #NEW_USER_ID#
		 WHERE USER_ID = #USER_ID#
    </update>

	<!-- 패널별 방문일 관리 USER_ID 수정 -->
	<update id="updateRDEI301DT" parameterClass="HashMap">
        /* MyPage.updateRDEI301DT */
        UPDATE RDEI301DT
		   SET USER_ID = #NEW_USER_ID#
		 WHERE USER_ID = #USER_ID#
    </update>

	<!-- 시험별 Q&A REGI_USER_ID 수정 -->
	<update id="updateRDEI401DT" parameterClass="HashMap">
        /* MyPage.updateRDEI401DT */
        UPDATE RDEI401DT
		   SET REGI_USER_ID = #NEW_USER_ID#
		 WHERE REGI_USER_ID = #USER_ID#
    </update>

	<!-- 패널 답변 정보 USER_ID 수정 -->
	<update id="updateRDSR201DT" parameterClass="HashMap">
        /* MyPage.updateRDSR201DT */
        UPDATE RDSR201DT
		   SET USER_ID = #NEW_USER_ID#
		 WHERE USER_ID = #USER_ID#
    </update>
    
    <!-- 회원 탈퇴 -->
    <insert id="insertMemberLeave" parameterClass="com.rdpanel.cmmn.security.Panel">
        /* MyPage.insertMemberLeave */
        INSERT INTO
            RDUR201DT
            (
                USER_ID
                ,GENDER
                ,AGE
                ,LEAVE_DT
                ,LEAVE_FINISH_YN
            )
        VALUES
            (
                #USER_ID#
                ,#GENDER_CD#
                ,#AGE#
                ,TO_CHAR(SYSDATE, 'YYYYMMDD')
                ,'Y'
            )
    </insert>
    
</sqlMap>
