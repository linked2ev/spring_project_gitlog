<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="PanelMain">
	

	<!-- 신규시험 모집공고 목록 -->
    <select id="selectNewTestAnnounceList" parameterClass="HashMap" resultClass="HashMap">
        /* PanelMain.selectNewTestAnnounceList */
		SELECT 
				*
		FROM 
				(
		        SELECT
		                B.EXAM_MNG_NO /* 시험관리번호 */
		                ,B.EXAM_WAY_CD
		                ,B.TEAM_GBN /* 시험구분 */
					    ,B.EXAM_TITLE /* 시험제목 */
		                ,TO_CHAR(TO_DATE(B.APP_PERIOD_FROM || B.APP_START_TIME, 'YYYYMMDDHH24MI'), 'YYYY.MM.DD HH24:MI') || ' ~ ' || TO_CHAR(TO_DATE(B.APP_PERIOD_TO || B.APP_END_TIME, 'YYYYMMDDHH24MI'), 'YYYY.MM.DD HH24:MI') AS APP_PERIOD /* 신청기간 */
		        FROM 
		        		RDEI102DT A
		         		INNER JOIN RDEI101MT B ON A.EXAM_MNG_NO = B.EXAM_MNG_NO
		        WHERE 
		                A.USER_ID = #USER_ID# /* 패널ID */
		           		AND A.MSG_TRAN_YN = 'Y' /* 공고전송 */
		           		AND B.APP_PERIOD_TO || B.APP_END_TIME >= TO_CHAR(SYSDATE, 'YYYYMMDDHH24MI') /* 신청일자 종료시까지 */
		        ORDER BY 
		        		B.APP_PERIOD_TO ASC, EXAM_MNG_NO DESC
		 		)
		 WHERE 
		 		ROWNUM <![CDATA[<]]> 6
    </select>
    
    
    
    <!-- 나의 스케줄 현황 목록 -->
    <select id="selectMyScheduleList" parameterClass="HashMap" resultClass="HashMap">
    	/* PanelMain.selectMyScheduleList */
		SELECT
				*
		FROM 
				(
		        SELECT
		        		'방문' AS GBN
		        		,C.EXAM_WAY_CD
		                ,'01' AS GBN_CD
		                ,B.EXAM_MNG_NO
		                ,C.TEAM_GBN
		                ,C.EXAM_TITLE
		                ,TO_CHAR(TO_DATE(B.VISIT_DATE, 'YYYYMMDD'), 'MONTHDD"일" DAY') AS VISIT_DATE
		                ,SUBSTR(B.VISIT_TIME_FROM, 1, 2) || ':' || SUBSTR(B.VISIT_TIME_FROM, 3, 2) || ' ~ ' || SUBSTR(B.VISIT_TIME_TO, 1, 2) || ':' || SUBSTR(B.VISIT_TIME_TO, 3, 2) AS VISIT_TIME
		                ,CASE C.VISIT_AREA_CD WHEN '01' THEN '서울 본사'
		                                    WHEN '02' THEN '용인 연구소'
		                END AS VISIT_AREA
		                ,C.VISIT_PLACE
		        FROM 
		        		RDEI301DT A
		         		INNER JOIN RDEI103DT B ON A.EXAM_MNG_NO = B.EXAM_MNG_NO AND A.VISIT_MNG_NO = B.VISIT_MNG_NO
		         		INNER JOIN RDEI101MT C ON B.EXAM_MNG_NO = C.EXAM_MNG_NO
		        WHERE 
		        		A.USER_ID = #USER_ID#
		           		AND B.VISIT_DATE >= TO_CHAR(SYSDATE, 'YYYYMMDD')
		        UNION
		        SELECT
		        		'설문작성' AS GBN
		                ,B.EXAM_WAY_CD
		                ,'02' AS GBN_CD
		                ,A.EXAM_MNG_NO
		                ,B.TEAM_GBN
		                ,B.EXAM_TITLE
		                ,TO_CHAR(TO_DATE(D.VISIT_DATE, 'YYYYMMDD'), 'YYYY.MM.DD') AS VISIT_DATE
		                ,'' AS VISIT_TIME
		                ,'' AS VISIT_AREA
		                ,'' AS VISIT_PLACE
		        FROM 
		        		RDEI102DT A
		         		INNER JOIN RDEI101MT B ON A.EXAM_MNG_NO = B.EXAM_MNG_NO
		         		INNER JOIN RDEI301DT C ON A.EXAM_MNG_NO = C.EXAM_MNG_NO AND A.USER_ID = C.USER_ID
		         		INNER JOIN RDEI103DT D ON C.EXAM_MNG_NO = D.EXAM_MNG_NO AND C.VISIT_MNG_NO = D.VISIT_MNG_NO
		         	    INNER JOIN RDEI105DT E ON C.EXAM_MNG_NO = E.EXAM_MNG_NO AND E.FINISH_YN <![CDATA[<>]]> 'Y'
		        WHERE 
		                A.USER_ID = #USER_ID#
		           		AND A.PANEL_SEL_YN = 'Y'
		           		AND D.SURVEY_PREPARE_YN = 'Y'
		           		AND D.VISIT_DATE = TO_CHAR(SYSDATE, 'YYYYMMDD')
		        UNION
		        SELECT
		                '설문작성' AS GBN
		                ,B.EXAM_WAY_CD
		                ,'02' AS GBN_CD
		                ,A.EXAM_MNG_NO
		                ,B.TEAM_GBN
		                ,B.EXAM_TITLE
		                ,TO_CHAR(SYSDATE, 'YYYY.MM.DD') AS VISIT_DATE
		                ,'' AS VISIT_TIME
		                ,'' AS VISIT_AREA
		                ,'' AS VISIT_PLACE
		        FROM 
		        		RDEI102DT A
		         		INNER JOIN RDEI101MT B ON A.EXAM_MNG_NO = B.EXAM_MNG_NO
		         		INNER JOIN RDEI104DT C ON A.EXAM_MNG_NO = C.EXAM_MNG_NO AND ((TO_CHAR(SYSDATE, 'YYYYMMDD') BETWEEN C.SURVEY_PERIOD_FROM AND C.SURVEY_PERIOD_TO) OR TO_CHAR(SYSDATE, 'YYYYMMDD') = C.SURVEY_PREPARE_DATE)
		         		INNER JOIN RDEI105DT E ON C.EXAM_MNG_NO = E.EXAM_MNG_NO AND E.FINISH_YN <![CDATA[<>]]> 'Y'
           		WHERE
		           		A.USER_ID = #USER_ID#
		           		AND A.PANEL_SEL_YN = 'Y'
		        UNION
		        SELECT
		        		'패널선정' AS GBN
		        		,B.EXAM_WAY_CD
		                ,'03' AS GBN_CD
		                ,A.EXAM_MNG_NO
		                ,B.TEAM_GBN
		                ,B.EXAM_TITLE
		                ,'' AS VISIT_DATE
		                ,'' AS VISIT_TIME
		                ,'' AS VISIT_AREA
		                ,'' AS VISIT_PLACE
		        FROM 
		        		RDEI102DT A
		         		INNER JOIN RDEI101MT B ON A.EXAM_MNG_NO = B.EXAM_MNG_NO
        		WHERE 
		         		A.USER_ID = #USER_ID#
		          		AND A.PANEL_SEL_YN = 'Y'
		           		AND B.EXAM_PERIOD_FROM >= TO_CHAR(SYSDATE, 'YYYYMMDD')
		        UNION
		        SELECT
		                '신청중' AS GBN
		                ,B.EXAM_WAY_CD
		                ,'04' AS GBN_CD
		                ,A.EXAM_MNG_NO
		                ,B.TEAM_GBN
		                ,B.EXAM_TITLE
		                ,'' AS VISIT_DATE
		                ,'' AS VISIT_TIME
		                ,'' AS VISIT_AREA
		                ,'' AS VISIT_PLACE
		        FROM 
		        		RDEI102DT A
		         		INNER JOIN RDEI101MT B ON A.EXAM_MNG_NO = B.EXAM_MNG_NO
		        WHERE 
		 	       		A.USER_ID = #USER_ID#
			            AND A.EXAM_APP_YN = 'Y'
		           		AND A.PANEL_SEL_YN IS NULL
		     	      	AND B.EXAM_PERIOD_FROM >= TO_CHAR(SYSDATE, 'YYYYMMDD')
		       	)
		  ORDER BY 
		  		GBN_CD, VISIT_DATE
    </select>
    

</sqlMap>
